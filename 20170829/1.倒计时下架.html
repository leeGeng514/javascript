<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>

        body{
            background-color: darksalmon;
        }


        #box{
            width:900px;
            height:auto;
            overflow: hidden;
            margin:auto;
        }
        .shop-list{
            overflow: hidden;
        }
        .count{
            padding:10px;
        }
        p{
            font-size:12px;
            padding:10px;
        }
        .shop{
            float: left;
            margin:10px;
            width:200px;
            height:402px;
            position: relative;
            font-size:12px;
        }
        .shake{
            position: absolute;
            background-color: #fff;
            width:100%;
        }
        .set-time{
            background-color: #000;
            padding:5px;
        }
        input{
            border:none;
            border-bottom:1px solid #fff;
            width:110px;
            background-color: transparent;
            padding:5px;
            outline: none;
            color:#fff;
        }
        img{
            width:100%;
        }
        a{
            display: inline-block;
            border:1px solid #fff;
            color:#fff;
            width:50px;
            padding:5px;
            text-align: center;
            text-decoration: none;
            font-size:12px;
        }
        ul{
            overflow: hidden;
            list-style: none;
            padding:0;
            margin:0 10px;
            background-color: #fff;

        }
        li{
            float: left;
            background-color: #fff;
            padding:30px 0;
            line-height: 50px;
            border-bottom:1px solid #000;
            font-size:12px;
        }
        li img{
            width:50px;
        }
        li:nth-of-type(1){
            width: 400px;
        }
        li:nth-of-type(2){
            width: 400px;
        }
        li:nth-of-type(3){
            width:80px;
            text-align: center;
            line-height: 1;
            font-size:0;
        }
        h2{
            background-color: #000;
            color:#fff;
            font-size:14px;
            margin:0 10px;
            padding:10px;
        }
        h2 span{
            display: inline-block;
            width:400px;
        }


        .mark{
            position: absolute;
            top:0;
            left:0;
            right:0;
            bottom:0;
            display: none;
        }
        .black{
            position: absolute;
            top:0;
            left:0;
            right:0;
            bottom:0;
            background-color: black;
            opacity: 0;

        }
        .c{
            width:100px;
            height:100px;
            border:1px solid #D0566E;
            border-radius:50px;
            position: absolute;
            top:50%;
            left:50%;
            margin-left:-50px;
            margin-top:-50px;
            transform: scale(3) rotateZ(-30deg);
            color:#D0566E;
            line-height: 100px;
            text-align: center;
        }


    </style>
    <script src="MTween.js"></script>
</head>
<body>

<div id="box">
    <div class="shop-list">


        <div class="shop">
            <div class="shake">
            <div class="set-time">
                <input type="text" value="2017-8-29 12:30:45">
                <a href="javascript:;">确定</a>
            </div>
            <div class="count">
                剩余：
                <span>00</span> 天
                <span>00</span> 时
                <span>00</span> 分
                <span>00</span> 秒
            </div>

            <div class="info">
                <img src="1.jpg" alt="">
                <p>小米(MI)Air 13.3英寸全金属轻薄笔记本</p>
                <p>价格：¥4999.00</p>
            </div>

            <div class="mark">
                <div class="black"></div>
                <div class="c">商品已下架</div>
            </div>
            </div>

        </div>

        <div class="shop">
            <div class="shake">
                <div class="set-time">
                    <input type="text">
                    <a href="javascript:;">确定</a>
                </div>
                <div class="count">
                    剩余：
                    <span>00</span> 天
                    <span>00</span> 时
                    <span>00</span> 分
                    <span>00</span> 秒
                </div>

                <div class="info">
                    <img src="1.jpg" alt="">
                    <p>小米(MI)Air 13.3英寸全金属轻薄笔记本</p>
                    <p>价格：¥4999.00</p>
                </div>

                <div class="mark">
                    <div class="black"></div>
                    <div class="c">商品已下架</div>
                </div>
            </div>

        </div>


        <div class="shop">
            <div class="shake">
                <div class="set-time">
                    <input type="text">
                    <a href="javascript:;">确定</a>
                </div>
                <div class="count">
                    剩余：
                    <span>00</span> 天
                    <span>00</span> 时
                    <span>00</span> 分
                    <span>00</span> 秒
                </div>

                <div class="info">
                    <img src="1.jpg" alt="">
                    <p>小米(MI)Air 13.3英寸全金属轻薄笔记本</p>
                    <p>价格：¥4999.00</p>
                </div>

                <div class="mark">
                    <div class="black"></div>
                    <div class="c">商品已下架</div>
                </div>
            </div>

        </div>


        <div class="shop">
            <div class="shake">
                <div class="set-time">
                    <input type="text">
                    <a href="javascript:;">确定</a>
                </div>
                <div class="count">
                    剩余：
                    <span>00</span> 天
                    <span>00</span> 时
                    <span>00</span> 分
                    <span>00</span> 秒
                </div>

                <div class="info">
                    <img src="1.jpg" alt="">
                    <p>小米(MI)Air 13.3英寸全金属轻薄笔记本</p>
                    <p>价格：¥4999.00</p>
                </div>

                <div class="mark">
                    <div class="black"></div>
                    <div class="c">商品已下架</div>
                </div>
            </div>

        </div>



    </div>
    <div class="down-list">
        <h2>
            <span>商品</span>
            <span>价格</span>
        </h2>
        <!--<ul>-->
            <!--<li>小米(MI)Air 13.3英寸全金属轻薄笔记本</li>-->
            <!--<li>¥4999.00</li>-->
            <!--<li><img src="1.jpg" alt=""></li>-->
        <!--</ul>-->
    </div>
</div>

<script src="MTween.js"></script>

<script>




        /*
        * 1.获取时间，生成时间戳
        * 2.倒计时
        * 3.缩小动画
        * 4.透明度动画
        * 5.抖动
        * 6.生成下架商品列表
        * */


        var shop = document.querySelectorAll('.shop');

        for(var i=0;i<shop.length;i++){

            init(shop[i]);

        }


        //初始化执行的函数
        function init(obj){


//            var fn = function(t){
//                alert(t);
//            };
//
//            fn(time);


            //获取时间戳
            get_time(obj,function(t){
                //获取到了时间戳  开始倒计时

//                console.log(time);
                countDown(obj,t,function(){
                    //倒计时结束时要做的事情
                    //缩小动画
                    c(obj,function(){
                        //缩小以后要做的事情
                        var black = obj.querySelector('.mark .black');
                        opa(black,0.5,function(){
                            var sha = obj.querySelector('.shake');
                            shake(sha,'marginLeft',20,10,function(){
                                showList(obj);
                            });
                        });
                    });
                });
            });
        }










        //1.获取时间，生成时间戳
        function get_time(obj,fn){
            var input = obj.querySelector('.set-time input');
            var btn = obj.querySelector('.set-time a');

            btn.onclick = function(){
                var val = input.value;

                if(!val){//内容为空  直接跳出函数 不执行任何事情
                    alert('shop[0]时间不能为空');
                    return;
                }

                //2017-8-29 12:30:45
                //arr = [2017,8,29,12,30,45]
                //装拆分之后的时间值
                var arr = val.split(' ');
                //['2017-8-29','12:30:45']
                var arr1 = arr[0].split('-');
                //['2017','8','29']
                var arr2 = arr[1].split(':');
                //['12','30','45']

                arr = arr1.concat(arr2);
                //['2017','8','29','12','30','45']

                //要获取时间戳
                var time = new Date(arr[0],arr[1]-1,arr[2],arr[3],arr[4],arr[5]).getTime();

                fn&&fn(time);

            };
        }


        //2.倒计时
        function countDown(obj,endTime,fn){


            var spans = obj.querySelectorAll('.count span');

            /*
            * endTime  到达时间
            * currTime 当前时间
            *
            *
            * 1.计算时间差  endTime-currTime
            * 2.根据时间差来换算  天  时  分 秒
            *
            * */

//            var endTime = 1503975520000;
            count();
            clearInterval(obj.timer);
            obj.timer = setInterval(function(){

                count(fn);

            },1000);


            //统计时间
            function count(fn){
                var currTime = new Date().getTime();
//            var currTime = Date.now();


                //计算时间差
                var time = endTime-currTime;

                if(time<=0){
                    time = 0;
                    clearInterval( obj.timer );
                    fn&&fn();
                }

                //换算
                //天
                var d = parseInt(time/(24*60*60*1000));
                //时
                var h = parseInt(time%(24*60*60*1000)/(60*60*1000));
                //分
                var m = parseInt(time%(60*60*1000)/(60*1000));
                //秒
                var s = parseInt(time%(60*1000)/1000);

                if(d<10) d = '0'+d;
                if(h<10) h = '0'+h;
                if(m<10) m = '0'+m;
                if(s<10) s = '0'+s;

                spans[0].innerHTML = d;
                spans[1].innerHTML = h;
                spans[2].innerHTML = m;
                spans[3].innerHTML = s;
            }

        }


        //3.缩小动画
        function c(obj,fn){

            //缩小的元素
            var c = obj.querySelector('.mark .c');

            var mark = obj.querySelector('.mark');

            mark.style.display = 'block';

            var b = 300;//初识的放大倍数





            clearInterval(c.timer);
            c.timer = setInterval(function(){
                b -= 10;
                c.style.transform = 'scale('+b/100+') rotateZ(-30deg)';
                if(b<=100){
                    b = 100;
                    clearInterval(c.timer);
                    fn&&fn();
                }
            },30)


        }


        //4.透明度动画
        function opa(obj,end,fn){

//            var black = shop[0].querySelector('.black');

            //初识透明
            var opacity = 0;

            clearInterval(obj.timer);
            obj.timer = setInterval(function(){

                opacity += 10;

                obj.style.opacity = opacity/100;

                if(opacity>=end*100){
                    opacity=end*100;
                    clearInterval(obj.timer);
                    fn&&fn();
                }

            },30);


        }


        //* 6.生成下架商品列表
        function showList(obj){

            var listBox = document.querySelector('.down-list');

            var name = obj.querySelectorAll('.info p')[0].innerHTML;
            var price = obj.querySelectorAll('.info p')[1].innerHTML;
            var thumbSrc = obj.querySelector('.info img').src;


            listBox.innerHTML += '<ul><li>'+name+'</li><li>'+price+'</li><li><img src="'+thumbSrc+'" alt=""></li></ul>';

            listBox.style.opacity = 0;

            opa(listBox,1);

        }










</script>
</body>
</html>